# 四象限任务管理工具

基于PyQt6开发的桌面效率工具，帮助用户通过艾森豪威尔矩阵管理任务。支持桌面融合模式、任务拖拽管理、自定义样式配置等功能。

## 功能特性

### 用户功能
- 📌 四象限任务管理：重要/紧急维度分类
- 🎨 深度自定义：支持配置颜色、透明度、圆角等样式
- 🔄 撤销操作
- 📅 任务到期日期管理
- 🖌️ 拖拽式任务管理
- 💾 自动保存配置和任务状态
- 📚 **历史记录功能**：每个字段的完整修改历史
- 👆 **导出任务支持“导出在办”与“导出所有”两种方式**
- 👁️ **逻辑删除**：已完成任务保留历史，不物理删除
- 🔍 **历史查看器**：专门的历史记录查看界面

### 开发功能
- 📦 可扩展字段系统（见`task_label.EDITABLE_FIELDS`）
- 🎭 完善的动画系统（淡入淡出、拖拽反馈）
- 📄 详尽的日志系统（操作轨迹可追溯）

## 快速开始

### 安装依赖
```bash
pip install -r requirements.txt
```

### 启动程序
```bash
python main.py
```

## 开发指南
### 目录结构
```plaintext
task_manage/
├── quadrant_widget.py      # 主界面逻辑
├── task_label.py           # 任务标签组件
├── config_manager.py       # 配置持久化管理
├── database_manager.py     # 数据库管理器（新增）
├── add_task_dialog.py      # 任务添加对话框
├── history_viewer.py       # 历史记录查看器
├── migrate_data.py         # 旧数据迁移工具
├── migrate_to_database.py  # JSON到数据库迁移工具（新增）
├── database_backup.py      # 数据库备份工具（新增）
└── main.py                 # 程序入口
```

### 配置系统
- 配置文件路径： `config.json`
- 热更新机制：通过 `save_config` 实现配置即时保存
- 扩展配置项：修改 `DEFAULT_CONFIG` 字典后自动合并到现有配置
### 任务系统
- 数据结构：通过 `get_data` 序列化任务状态
- 持久化存储：自动保存到 SQLite 数据库（`task_manager.db`）
- 字段扩展：修改 `TaskLabel.EDITABLE_FIELDS` 添加新字段
- 历史记录：每个字段的完整修改历史，支持查看和追溯
- 逻辑删除：已完成任务标记隐藏，保留完整历史数据
### 数据库系统
- 数据库类型：SQLite（轻量级、无需服务器）
- 数据库文件：`task_manager.db`
- 表结构：tasks（任务）、task_fields（字段值）、task_field_history（历史记录）
- 数据迁移：支持从JSON文件自动迁移到数据库
- 备份恢复：提供完整的数据库备份和恢复功能

## 历史记录功能

### 新功能特性
- **字段历史记录**：每个任务字段（text、notes、due_date等）都保存完整的历史记录
- **逻辑删除**：已完成的任务只是从界面隐藏，不从数据文件中物理删除
- **不可逆修改**：UI界面的改动不会直接修改历史数据，而是追加新的历史记录
- **历史查看器**：提供专门的历史记录查看界面

### 使用方法
1. **查看历史记录**：右键点击任务标签 → 选择"历史记录"
2. **任务管理**：
   - 编辑任务：双击任务或右键选择"编辑"
   - 完成任务：勾选复选框，任务会隐藏但保留历史
   - 删除任务：右键选择"删除"，任务标记为逻辑删除

### 数据迁移
- 首次启动时自动检测并迁移旧格式数据
- 自动创建备份文件（tasks_backup.json）
- 数据库迁移：运行 `python migrate_to_database.py` 将JSON数据迁移到SQLite数据库